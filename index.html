<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="color-scheme" content="light">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    <title>Tiny Meow Abode - æ–¹å¯¸å–µå±…</title>
    <!-- å¤–éƒ¨CSSæ ·å¼è¡¨ -->
    <link rel="stylesheet" href="./styles/main.css">
    <link rel="stylesheet" href="./styles/photo-mode.css">
    <!-- [æ–°å¢] ç§»åŠ¨ç«¯å“åº”å¼æ ·å¼ -->
    <link rel="stylesheet" href="./styles/mobile.css">
    <!-- å†…è”æ ·å¼å·²è¿ç§»åˆ° styles/main.css -->
    <script>
        function logToScreen(msg, type = 'info') {
            const consoleDiv = document.getElementById('debug-console');
            if (consoleDiv) {
                //consoleDiv.style.display = 'block'; 
                const line = document.createElement('div');
                line.textContent = `> ${msg}`;
                if (type === 'error') line.className = 'log-error';
                else if (type === 'warn') line.className = 'log-warn'; consoleDiv.appendChild(line); consoleDiv.scrollTop = consoleDiv.scrollHeight;
            } console.log(msg);
        }
        window.onerror = function (msg, url, line) { logToScreen(`ERROR: ${msg} (Line ${line})`, 'error'); return false; };
    </script>
    <!-- vConsole å·²ç§»é™¤ï¼Œå¦‚éœ€è°ƒè¯•è¯·æ‰‹åŠ¨åŠ è½½ -->
</head>

<body>

    <!-- debug-console å·²éšè— -->

    <div id="loading-screen">
        <div id="loading-text">èµ„æºåŠ è½½ä¸­...</div>
        <div id="progress-bar">
            <div id="progress-fill"></div>
        </div>
        <div id="version-text"
            style="position:absolute; bottom:10px; right:10px; color:rgba(255,255,255,0.5); font-size:12px;"></div>
        <button id="force-start-btn" onclick="window.forceStart()" style="display:none;">âš ï¸ å¼ºåˆ¶è¿›å…¥æ¸¸æˆ</button>
    </div>

    <div id="confirm-dialog">
        <h3 id="dialog-title">è¡¥å……çŒ«ç²®?</h3>
        <p id="dialog-msg">éœ€è¦æ¶ˆè€— 10 çˆ±å¿ƒ</p>
        <div class="dialog-btns">
            <button class="dialog-btn btn-no" onclick="closeDialog()">å–æ¶ˆ</button>
            <button class="dialog-btn btn-yes" id="btn-confirm-yes">ç¡®å®š</button>
        </div>
    </div>



    <div id="tutorial">
        <strong>æ–¹å¯¸å–µå±… (Tiny Meow Abode)</strong><br>
        1. ä¿®å¤çŒ«å’ªç¡è§‰"è¸¢è…¿"/æ¥å›èµ°<br>
        2. åƒé¥­å¯¹å‡†/ç«™çŒ«ç ‚ç›†ä¸Š<br>
        3. çŠ¶æ€æ å¸¸é©»å·¦ä¸‹è§’<br>
        <div style="margin-top:5px; border-top:1px solid #ccc; padding-top:5px;"><span id="status-text">åˆå§‹åŒ–...</span>
        </div>
    </div>

    <!-- ================== æ–°ç‰ˆ HUD ================== -->

    <!-- 1. å·¦ä¸Šè§’ï¼šæ—¶é—´ä¸çŠ¶æ€ -->
    <div id="hud-top-left">
        <!-- æ—¶é—´ç»„ä»¶ -->
        <div id="time-widget">
            <div id="time-bg">
                <!-- æ˜¾ç¤ºæ—¶é—´ -->
                <span id="time-text-display">12:00</span>
                <span id="time-ampm">PM</span>
            </div>
            <!-- å¤©æ°”/å…‰å½±æ§åˆ¶å…¥å£ -->
            <div id="weather-icon-container" onclick="toggleTimePopover()">
                <img id="weather-icon-img" src="./assets/ui/icon_sun.png">
            </div>
            <!-- [æ–°å¢] å¤©æ°”åˆ‡æ¢æŒ‰é’® -->
            <div id="weather-toggle-btn" onclick="cycleWeather()">
                <img src="./assets/ui/weather/weather_bg.png" class="weather-btn-bg">
                <img id="weather-btn-icon" src="./assets/ui/weather/sunny.png" class="weather-btn-icon">
            </div>
            <!-- éšè—çš„æ»‘å—æ§åˆ¶æ¡ (Popover) -->
            <div id="time-popover" class="hidden">
                <input type="range" id="time-slider-hud" min="0" max="23.99" step="0.01">
                <button id="time-reset-btn" title="é‡ç½®æ—¶é—´">â†»</button>
            </div>
        </div>

        <!-- çˆ±å¿ƒç»„ä»¶ -->
        <div id="heart-widget">
            <!-- å›¾æ ‡æ”¾åœ¨èƒŒæ™¯å¤–é¢ï¼Œæ–¹ä¾¿ç»å¯¹å®šä½ -->
            <img src="./assets/ui/icon_heart.png" id="heart-icon-img">
            <div id="heart-bg">
                <span id="heart-text-display">500</span>
            </div>
        </div>

        <!-- ç”Ÿç†çŠ¶æ€ç»„ä»¶ -->
        <div id="status-widget-group">
            <!-- é¥±é£Ÿåº¦ -->
            <div class="status-circle">
                <!-- 1. åº•å±‚ Frame -->
                <img src="./assets/ui/hunger_icon_frame.png" class="status-frame">

                <!-- 2. ä¸­é—´ Mask (è´Ÿè´£åˆ‡åœ†è§’) -->
                <div class="liquid-mask">
                    <!-- [æ–°å¢] æ°´ä½å®¹å™¨ (è´Ÿè´£æ§åˆ¶é«˜åº¦) -->
                    <div class="liquid-level" id="level-hunger">
                        <!-- æ¶²ä½“çº¹ç† (é«˜åº¦å›ºå®šï¼Œæ²‰åº•) -->
                        <img src="./assets/ui/hunger_icon_fill.png" class="liquid-texture">
                    </div>
                </div>

                <!-- 3. é¡¶å±‚ Icon -->
                <img src="./assets/ui/hunger_icon.png" class="status-icon-fg">
            </div>

            <!-- ä¾¿ä¾¿å€¼ -->
            <div class="status-circle">
                <img src="./assets/ui/toilet_icon_frame.png" class="status-frame">
                <div class="liquid-mask">
                    <div class="liquid-level" id="level-toilet">
                        <img src="./assets/ui/toilet_icon_fill.png" class="liquid-texture">
                    </div>
                </div>
                <img src="./assets/ui/toilet_icon.png" class="status-icon-fg">
            </div>
        </div>

    </div>

    <!-- [æ–°å¢] å³ä¸Šè§’ Debug å·¥å…·æ  HTML -->
    <div id="debug-panel">
        <button class="debug-btn debug-only" style="display:none;" onclick="debugAddMoney()">+$$</button>
        <button class="debug-btn debug-only" style="display:none;" onclick="debugResetCat()">é‡ç½®çŒ«</button>
        <button class="debug-btn debug-only" style="display:none;" onclick="window.debugCatInfo()">ğŸ± çŒ«å’ªçŠ¶æ€</button>
        <button class="debug-btn debug-only" style="display:none;" onclick="window.debugForceToilet()">ğŸš½ ä¸Šå•æ‰€</button>
        <button class="debug-btn debug-only" style="display:none;" onclick="toggleDebugGizmos()">çº¿æ¡†</button>
        <button class="debug-btn debug-only" style="display:none;" onclick="toggleConsole()">ğŸ“œ æ—¥å¿—</button>
        <button class="debug-btn debug-only" style="display:none;" onclick="window.debugGenDiary()">ğŸ“ ç”Ÿæˆ</button>
        <button class="debug-btn debug-only" style="display:none;" onclick="window.debugClearDiary()">ğŸ—‘ï¸ æ¸…ç©º</button>
        <!-- [æ–°å¢] é˜´å½±å¼€å…³æŒ‰é’® -->
        <button class="debug-btn debug-only" style="display:none;" onclick="window.toggleShadows()">ğŸŒ‘ é˜´å½±</button>
        <button class="debug-btn debug-only" style="display:none;" onclick="window.toggleWeather()">ğŸŒ¤ï¸ å¤©æ°”</button>
        <!-- [æ–°å¢] å­˜æ¡£å¯¼å‡º/å¯¼å…¥æŒ‰é’® -->
        <button class="debug-btn" onclick="window.exportSaveToFile()">ğŸ’¾ ä¿å­˜</button>
        <button class="debug-btn" onclick="window.importSaveFromFile()">ğŸ“‚ è¯»å–</button>
        <button class="debug-btn debug-only" style="display:none;" onclick="window.debugClearSave()"
            style="color:#ff6b6b;">ğŸ—‘ï¸ æ¸…æ¡£</button>
    </div>

    <!-- 2. åº•éƒ¨ï¼šåŠŸèƒ½å…¥å£ -->
    <div id="hud-bottom-bar">
        <div class="hud-btn-container" onclick="toggleDiary()">
            <img src="./assets/ui/btn_diary.png" class="hud-main-btn">
            <div id="diary-red-dot-hud"></div>
        </div>
        <div class="hud-btn-container" onclick="toggleShop()">
            <img src="./assets/ui/btn_shop.png" class="hud-main-btn">
        </div>
    </div>

    <!-- [æ–°å¢] ç§»åŠ¨ç«¯ä¸“å±æ“ä½œæ ï¼ˆç¼–è¾‘æ¨¡å¼æ—¶æ˜¾ç¤ºï¼‰ -->
    <div id="mobile-controls">
        <button id="btn-mobile-cancel" class="mobile-ctrl-btn">âŒ</button>
        <button id="btn-mobile-rotate" class="mobile-ctrl-btn">ğŸ”„</button>
        <button id="btn-mobile-confirm" class="mobile-ctrl-btn">âœ…</button>
    </div>

    <!-- 3. å•†åº—é¢æ¿ (ä¿®æ”¹åŸæœ‰ç»“æ„ï¼Œå¢åŠ å…³é—­æŒ‰é’®) -->
    <!-- 3. å•†åº—é¢æ¿ (è½¯æœ¨æ¿é£æ ¼) -->
    <div id="shop-panel-container" class="hidden-bottom">

        <!-- èƒŒæ™¯æ¿ä¸Šçš„æ ‡é¢˜ç‰Œ -->
        <img src="./assets/ui/shop_title_sign.png" id="shop-title-img">

        <!-- å…³é—­æŒ‰é’® -->
        <button id="shop-close-btn" onclick="toggleShop()"></button>

        <!-- é¡µç­¾æ  (å›¾æ ‡åŒ–) -->
        <div id="shop-tabs">
            <!-- å®¶å…· -->
            <div class="shop-tab active" onclick="switchCategory('furniture')">
                <img src="./assets/ui/tab_bg_active.png" class="tab-bg">
                <img src="./assets/ui/tab_furniture.png" class="tab-icon">
            </div>
            <!-- å°ç‰©ä»¶ -->
            <div class="shop-tab" onclick="switchCategory('small')">
                <img src="./assets/ui/tab_bg_active.png" class="tab-bg">
                <img src="./assets/ui/tab_small.png" class="tab-icon">
            </div>
            <!-- å£æŒ‚ç‰© -->
            <div class="shop-tab" onclick="switchCategory('wall')">
                <img src="./assets/ui/tab_bg_active.png" class="tab-bg">
                <img src="./assets/ui/tab_wall.png" class="tab-icon">
            </div>
            <!-- å¢™çº¸ -->
            <div class="shop-tab" onclick="switchCategory('wallpaper')">
                <img src="./assets/ui/tab_bg_active.png" class="tab-bg">
                <img src="./assets/ui/tab_wallpaper.png" class="tab-icon">
            </div>
            <!-- åœ°æ¿ -->
            <div class="shop-tab" onclick="switchCategory('flooring')">
                <img src="./assets/ui/tab_bg_active.png" class="tab-bg">
                <img src="./assets/ui/tab_flooring.png" class="tab-icon">
            </div>
            <!-- åœ°æ¯¯ -->
            <div class="shop-tab" onclick="switchCategory('rug')">
                <img src="./assets/ui/tab_bg_active.png" class="tab-bg">
                <img src="./assets/ui/tab_rug.png" class="tab-icon">
            </div>
        </div>

        <!-- å•†å“åˆ—è¡¨æ»šåŠ¨åŒº -->
        <div id="items-scroll">
            <!-- JS åŠ¨æ€å¡«å…… -->
        </div>

        <!-- 2. è‡ªå®šä¹‰æ»šåŠ¨æ¡ç»„ä»¶ -->
        <div id="custom-scrollbar">
            <div id="custom-track"></div> <!-- ç»³å­ -->
            <div id="custom-thumb"></div> <!-- çŒ«å¤´ -->
        </div>
    </div>




    <div id="context-menu">
        <div class="context-btn" id="btn-move">ç§»åŠ¨ä½ç½®</div>
        <div class="context-btn btn-delete" id="btn-delete">åˆ é™¤å®¶å…·</div>
        <div class="context-btn" id="btn-cancel">å–æ¶ˆé€‰ä¸­</div>
    </div>
    <div id="cat-bubble" class="bubble hidden"><span id="bubble-icon">ğŸŸ</span></div>

    <!-- å¸¸é©»çŠ¶æ€é¢æ¿ -->


    <!-- æ—¥è®°æœ¬å¼¹çª— (æ¨¡æ€æ¡†) -->
    <div id="diary-modal" class="hidden">
        <div id="diary-book-container">
            <!-- å…³é—­æŒ‰é’® -->
            <button id="diary-close-btn" onclick="toggleDiary()"></button>

            <!-- æ—¥è®°ä¹¦æœ¬èƒŒæ™¯ -->
            <img src="./assets/ui/diary_book_bg.png" id="diary-bg-img">

            <!-- å·¦é¡µå†…å®¹ -->
            <div id="diary-left-page">
                <!-- æ‹ç«‹å¾—ç…§ç‰‡æ¡† -->
                <div id="polaroid-frame">
                    <img src="./assets/ui/diary_photo_placeholder_Frame.png" class="polaroid-bg">
                    <img src="./assets/ui/diary_photo_placeholder_Chrismas.png" class="polaroid-photo">
                    <img src="./assets/ui/diary_tape.png" class="polaroid-tape">
                    <span id="diary-photo-date" class="polaroid-text">Oct 24</span>
                    <span id="diary-photo-weather" class="polaroid-text">å¤©æ°”æ™´æœ—ï¼Œé€‚åˆç¡è§‰</span>

                    <!-- [æ–°å¢] æ‰‹åŠ¨æ‹ç…§æŒ‰é’® -->
                    <button id="manual-photo-btn" onclick="window.takeManualPhoto()" title="æ‹ä¸€å¼ ä»Šå¤©çš„ç…§ç‰‡">
                        <img src="./assets/ui/camera_icon.png" alt="æ‹ç…§">
                    </button>
                </div>
                <!-- è£…é¥°è´´çº¸ -->
                <img src="./assets/ui/diary_deco_fish.png" class="diary-deco-fish-left">
            </div>

            <!-- å³é¡µå†…å®¹ -->
            <div id="diary-right-page">
                <!-- æ—¥æœŸæ ‡é¢˜ (ä»åŸæ¥çš„h2ç§»è¿‡æ¥) -->
                <h3 id="diary-date-title" class="page-date-title">Oct 24</h3>
                <!-- å¿ƒæƒ…/å…³é”®è¯ (ä»åŸæ¥çš„divç§»è¿‡æ¥) -->
                <div id="diary-meta" class="page-meta">
                    <span id="diary-weather">ğŸŒ¤ï¸ å¤©æ°”ä¸é”™</span> |
                    <span id="diary-mood">ğŸ˜¾ å¿ƒæƒ…ä¸€èˆ¬</span>
                </div>

                <!-- æ—¥è®°æ¡ç›®å®¹å™¨ -->
                <div id="diary-entries-scroll">
                    <!-- JS ä¼šåœ¨è¿™é‡Œå¡«å……æ—¥è®°æ¡ç›® -->
                    <div class="entry empty-tip">ä»Šå¤©è¿˜æ²¡æœ‰æ—¥è®°...</div>
                </div>
                <!-- è£…é¥°è´´çº¸ -->
                <img src="./assets/ui/diary_deco_fish.png" class="diary-deco-fish-right">
                <img src="./assets/ui/diary_deco_paw.png" class="diary-deco-paw">
            </div>

            <!-- åº•éƒ¨å¯¼èˆªæŒ‰é’® -->
            <div id="diary-nav-buttons">
                <button id="btn-diary-prev" onclick="diaryManager.changePage(-1)">
                    <img src="./assets/ui/btn_diary_prev.png">
                </button>
                <button id="btn-diary-next" onclick="diaryManager.changePage(1)">
                    <img src="./assets/ui/btn_diary_next.png">
                </button>
            </div>

        </div>
    </div>

    <!-- [æ–°å¢] æ‹ç…§æ¨¡å¼è¦†ç›–å±‚ -->
    <div id="photo-mode-overlay" style="display: none;">
        <!-- ç›¸æœºæ¡†æ¶ -->
        <div id="camera-frame-container">
            <img src="./assets/ui/Camera.png" id="camera-frame-img">
            <!-- å–æ™¯æ¡†ä½ç½®æ ‡è®°ï¼ˆç”¨äºæˆªå›¾å®šä½ï¼‰ -->
            <div id="viewfinder-area"></div>
            <!-- å¿«é—¨æŒ‰é’® -->
            <button id="shutter-btn" onclick="window.capturePhoto()">
                <img src="./assets/ui/camera_button.png" id="camera-button-img">
            </button>
        </div>

        <!-- é€€å‡ºæŒ‰é’® -->
        <button id="exit-photo-mode-btn" onclick="window.exitPhotoMode()">âœ•</button>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://esm.sh/three@0.160.0", "three/addons/": "https://esm.sh/three@0.160.0/examples/jsm/" } }
    </script>

    <!-- ä¸»è¦JSå·²è¿ç§»åˆ° scripts/main.js -->
    <script type="module" src="./scripts/main.js"></script>
    <!-- <script type="module" src="./scripts/main.new.js"></script> -->
</body>

</html>