好的，明白。我们保持现有的“自动进入游戏”流程（这意味着背景音乐需要玩家第一次点击屏幕任意位置后才会开始播放，这是浏览器的硬性限制，但体验上更流畅）。
以下是截止到目前为止（V93）的完整项目设计文档。这份文档涵盖了我们这段时间所有的修改、优化和新增功能，作为你后续开发的基准。

《猫咪的家》项目设计文档 (V93 - 完整里程碑版)
版本：1.3 (Final Polish)
日期：2025-12-25
类型：Web 3D / 治愈系模拟 / 放置养成
核心体验：微缩景观风格的云养猫，强调“陪伴感”与“叙事性”。

1. 视觉与渲染 (Visuals & Rendering)
1.1 核心渲染管线

引擎：Three.js (r160) + WebGL。


色彩空间：THREE.SRGBColorSpace (确保贴图颜色准确)。


色调映射：THREE.ACESFilmicToneMapping (电影级质感)，曝光度 1.2。


阴影：PCFSoftShadowMap (软阴影)，配合优化的 bias (-0.0005) 和 normalBias (0.05) 消除波纹。

1.2 后期处理 (Post-Processing)

SSAO (环境光遮蔽)：增强物体接地感，消除漂浮感。


Bloom (辉光)：

o
阈值 0.95，强度 0.15。
o
o
仅让窗户、灯光、圣诞树装饰发光，避免地面产生“雾气”。
o

SMAA (抗锯齿)：平滑物体边缘。


Tilt-Shift (移轴模糊)：[NEW] 模拟微缩模型摄影效果，屏幕上下边缘模糊，中间清晰。

1.3 相机与视角

类型：正交相机 (OrthographicCamera)。


缩放：d = 12 (适中的微缩视野)。


初始位置：PanOffset = -6，初始视点略微偏下，留出上方 UI 空间。


2. 核心系统 (Core Systems)
2.1 时间系统 (Dual-Layer Time)

逻辑时间 (Real Time)：

o
完全同步现实世界时间（获取 new Date()）。
o
o
控制日记记录的时间戳、猫咪的作息规律。
o

视觉时间 (Visual Time)：

o
自动模式：跟随逻辑时间，太阳东升西落，光照色温随时间渐变（长过渡时间：日出4h，日落5h）。
o
o
手动模式：玩家拖动 UI 上的滑块，可强制改变天空颜色和光照（用于截图），不影响逻辑时间。
o
o
重置：点击 UI 上的 ↺ 按钮恢复自动模式。
o
2.2 经济与交互

货币：爱心 (Hearts)。


产出：抚摸猫咪 (+1/次)、回收纸箱 (+10/次)。


消耗：购买家具、补充猫粮 (-10)、清理猫砂 (-10)。


家具系统：

o
层级：地毯 (Layer 0)、地面家具 (Layer 1)、桌面小物 (Layer 2, isSurface: true)、墙面装饰。
o
o
特殊逻辑：
o

纸箱：购买 Layer 1 家具时概率生成，猫咪极爱钻箱子。


圣诞树：检测模型部件名（Star, Light, Ribbon），开启自发光（Emissive）配合 Bloom 效果。

2.3 存档系统 (Save/Load)

机制：localStorage 本地持久化。


保存内容：爱心数量、装修状态（墙/地）、所有已购家具的位置/旋转、猫咪生理状态、日记内容。


特殊：快递箱（Mystery Box）属于临时物品，刷新不保存。


3. 猫咪系统 (Cat AI)
3.1 基础属性

饥饿 (Hunger) / 如厕 (Toilet)。


状态栏：UI 左侧显示，采用液位球设计，颜色随数值涨落。

3.2 行为逻辑 (FSM)

Idle (闲逛)：随机游走。


Sleep (睡觉)：

o
优先寻找床/沙发。
o
o
位置修正：根据家具朝向，计算局部坐标偏移，确保猫咪睡在家具表面且不穿模（Z轴修正）。
o

Eat (进食)：

o
位置修正：开始进食时，强制瞬移到饭盆正前方 0.6米处并对齐朝向，防止隔空吃饭。
o

Poop (如厕)：

o
位置修正：跳上猫砂盆（Y轴抬升），结束后跳回地面。
o

Pet (被摸)：

o
判定：饿了/急了/生气时拒绝抚摸。
o
o
反馈：播放打呼噜音效 (meow_purr)，产生爱心。
o
o
冷却：设有 patience 阈值，摸多了会生气。
o
3.3 音效反馈

随机叫：闲暇时概率 meow_normal。


需求叫：饿/急时循环播放 meow_urgent 并头顶冒气泡。


互动：摸爽了 meow_purr，生气了 meow_angry。


4. 日记系统 (Diary System)
4.1 核心逻辑

入口：左下角书籍图标。


生成规则：输入（玩家行为/离线时长） -> 滤镜（傲娇猫设） -> 输出（文本）。


存储结构：按“日期”归档，每天一张纸。


翻页：支持查看历史日记。

4.2 内容模块

Meta 信息：每日生成一次天气、心情、关键词（特殊节日强制覆盖）。


离线日记：根据 LastLoginTime 补算离线期间的“脑补”日记。


交互日记：

o
权重系统：防止刷屏。特殊事件（买家具）权重 > 日常事件（抚摸）。
o
o
冷却系统：同一类事件（如抚摸）有 10分钟 冷却 CD。
o
o
傲娇滤镜：买贵家具 -> 吐槽家具，夸奖纸箱；喂食 -> 称之为进贡。
o
o
特定物品彩蛋：针对“圣诞树”、“电视”、“猫食盆”有专属文案。
o

特殊节日：平安夜、圣诞、元旦等日期，触发特殊天气、心情和置顶事件。

4.3 UI 表现

风格：B5 尺寸牛皮纸书本。


左页：拍立得照片（默认图，稍倾斜）+ 日期/天气。


右页：手写体日记列表。


装饰：小鱼饼干贴纸、胶带、肉垫印章。


5. 界面与交互 (UI & UX)
5.1 风格
粘土/软陶风格 (Claymorphism)：圆润、有厚度、低饱和度配色。
5.2 HUD 布局

左上角 (Time)：

o
圆形粘土表盘，始终显示真实时间。
o
o
右上角附着天气图标（可点击），点击弹出光影控制滑块。
o

左侧 (Status)：

o
爱心栏：长条胶囊，左侧大爱心，右侧数字。
o
o
状态球：两个圆形凹槽，内部绿色液体高度代表数值（容器裁剪法实现液位）。
o

底部 (Dock)：

o
日记入口（带红点提示）。
o
o
商店入口。
o

右上角：Debug 工具栏。

5.3 商店面板

外观：横向长条软木板，带木制边框。


布局：

o
顶部：4个图标页签（家具/小物/墙壁/装修），同排有关闭按钮。
o
o
中间：商品展示台（Shelf）+ 商品缩略图 + 价格吊牌（带小爱心）。
o
o
底部：自定义滚动条（绳子轨道 + 猫头滑块）。
o

交互：点击底部商店图标，面板从屏幕下方滑出。

5.4 音效 (Audio)

BGM：舒适的背景音乐（需玩家首次交互后播放）。


SFX：全套 UI 点击音、弹窗音、放置家具声、倒粮声、铲屎声、金币声。


这份文档概括了当前的最终形态。如果你准备好了，我们可以继续下一个任务（如果有的话），或者你可以根据这份文档进行验收测试。
