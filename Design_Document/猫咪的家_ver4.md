# 《猫咪的家》项目设计文档

**版本**：1.4 (Ver4 完整版)  
**日期**：2026-02-02  
**类型**：Web 3D / 治愈系模拟 / 放置养成  
**核心体验**：微缩景观风格的云养猫，强调"陪伴感"与"叙事性"。

---

## 1. 视觉与渲染 (Visuals & Rendering)

### 1.1 核心渲染管线

| 配置项 | 设置 |
|--------|------|
| 引擎 | Three.js (r160) + WebGL |
| 色彩空间 | THREE.SRGBColorSpace (确保贴图颜色准确) |
| 色调映射 | THREE.ACESFilmicToneMapping (电影级质感)，曝光度 1.2 |
| 阴影 | PCFSoftShadowMap (软阴影)，bias: -0.0005, normalBias: 0.05 |

### 1.2 后期处理 (Post-Processing)

| 效果 | 参数 | 说明 |
|------|------|------|
| SSAO | - | 环境光遮蔽，增强物体接地感 |
| Bloom | 阈值 0.95，强度 0.15 | 仅让窗户、灯光、圣诞树装饰发光 |
| SMAA | - | 抗锯齿，平滑物体边缘 |
| Tilt-Shift | - | 移轴模糊，模拟微缩模型摄影效果 |

### 1.3 相机与视角

| 配置项 | 设置 |
|--------|------|
| 类型 | 正交相机 (OrthographicCamera) |
| 缩放 | d = 12 (适中的微缩视野) |
| 初始位置 | PanOffset = -6，视点略微偏下，留出上方 UI 空间 |

### 1.4 动态天空系统 🆕

基于 Shader 的动态天空效果：

| 效果 | 说明 |
|------|------|
| 动森风格星空 | 夜间显示闪烁星星，分大星星(稀疏)和小星星(较多)两层 |
| 星星闪烁 | 基于时间的 sin 函数实现自然闪烁效果 |
| 银河氛围 | 高空区域的淡紫色银河光带 |
| 高度衰减 | 越靠近地平线，星星越淡 |
| 窗户天空 | 窗户内独立渲染天空，保持视觉一致性 |

---

## 2. 天气系统 (Weather System) 🆕

### 2.1 天气类型

| 天气 | 视觉效果 | 说明 |
|------|----------|------|
| 晴天 (clear) | 正常天空渐变 | 默认天气 |
| 雨天 (rain) | 雨滴粒子效果 | 粒子系统实现 |
| 雪天 (snow) | 雪花粒子效果 | 粒子系统实现 |

### 2.2 月度天气概率

| 月份 | 下雨概率 | 下雪概率 |
|------|----------|----------|
| 1月 | 0% | 20% |
| 2月 | 0% | 10% |
| 3-9月 | 0% | 0% |
| 10月 | 0% | 10% |
| 11月 | 0% | 20% |
| 12月 | 0% | 50% |

### 2.3 特殊日期天气

| 日期 | 强制天气 |
|------|----------|
| 12-25 圣诞节 | ❄️ 必定下雪 |
| 1-1 元旦 | ❄️ 下雪 |

---

## 3. 核心系统 (Core Systems)

### 3.1 时间系统 (Dual-Layer Time)

| 时间类型 | 说明 |
|----------|------|
| **逻辑时间** | 完全同步现实世界时间（`new Date()`），控制日记时间戳、猫咪作息 |
| **视觉时间** | 太阳东升西落，光照色温随时间渐变（日出4h过渡，日落5h过渡） |

**手动模式**：玩家拖动UI滑块可强制改变天空颜色和光照（用于截图），不影响逻辑时间。点击 ↺ 按钮恢复自动模式。

### 3.2 经济与交互

| 项目 | 说明 |
|------|------|
| 货币 | 爱心 (Hearts) |
| 产出 | 抚摸猫咪 (+1/次)、回收纸箱 (+10/次) |
| 消耗 | 购买家具、补充猫粮 (-10)、清理猫砂 (-10) |

### 3.3 家具系统

**层级结构**：

| 层级 | 类型 | 说明 |
|------|------|------|
| Layer 0 | 地毯 | 铺设在地面最底层 |
| Layer 1 | 地面家具 | 沙发、床、桌子等 |
| Layer 2 | 桌面小物 | `isSurface: true` 的家具可放置小物 |
| wall | 墙面装饰 | 挂在墙上的画、时钟、窗户等 |

**特殊家具配置**：

| 配置项 | 说明 |
|--------|------|
| `light: true` | 家具带光源 |
| `lightType` | 光源类型：`point`(点光源) 或 `spot`(聚光灯) |
| `lightOffset` | 光源位置偏移 |
| `wallFace` | 墙面家具贴墙方向：`back`/`front`/`left`/`right` |
| `canSleep` | 猫咪可以在此家具上睡觉 |
| `isToy` | 标记为玩具，可吸引猫咪 |

**纸箱机制**：购买 Layer 1 家具时概率生成快递箱，猫咪极爱钻箱子。

**圣诞树机制**：检测模型部件名（Star, Light, Ribbon），开启自发光配合 Bloom 效果。

### 3.4 玩具系统 🆕

| 玩具 | 交互方式 | 效果 |
|------|----------|------|
| 胡萝卜 (ToyCarrot) | 点击玩具 | 发出 `toy_squeak` 音效，吸引猫咪走过来查看 |

**限制条件**：猫咪在以下状态时不会响应玩具：
- 正在吃饭 (eating)
- 正在上厕所 (pooping)

### 3.5 存档系统 (Save/Load)

| 项目 | 说明 |
|------|------|
| 机制 | localStorage 本地持久化 |
| 保存内容 | 爱心数量、装修状态、家具位置/旋转、猫咪状态、日记内容 |
| 特殊 | 快递箱属于临时物品，刷新不保存 |
| 导出/导入 | 支持将存档导出为 JSON 字符串，可备份和恢复 |

---

## 4. 照片系统 (Photo System) 🆕

### 4.1 功能概述

游戏会自动为猫咪拍照并保存到日记本中，增强"养成记录感"。

### 4.2 自动拍照

| 项目 | 设置 |
|------|------|
| 触发间隔 | 每2小时检查一次 |
| 触发概率 | 30% |
| 智能选择 | 优先捕捉猫咪吃饭、睡觉、上厕所等有趣时刻 |
| 每日限制 | 一天只保留一张照片 |

### 4.3 手动拍照

1. 打开日记本（点击底部 📔 按钮）
2. 在左侧照片框右下角找到 📷 按钮
3. 点击即可拍摄今天的照片
4. **限制**：每天只能拍一张，已拍过则无法再拍

### 4.4 照片存储

| 项目 | 设置 |
|------|------|
| 格式 | JPEG (quality: 0.7) |
| 尺寸 | 300×300 像素 |
| 存储位置 | LocalStorage (`cat_game_photos_v1`) |
| 保留天数 | 30天（自动清理旧照片） |

### 4.5 拍照特效

- 拍照时自动隐藏所有 UI 元素
- 智能调整相机到最佳位置（猫咪前方2-3米，俯视角度）
- 拍照闪光效果反馈

---

## 5. 猫咪系统 (Cat AI)

### 5.1 基础属性

| 属性 | 说明 |
|------|------|
| 饥饿 (Hunger) | 随时间下降，需要吃饭补充 |
| 如厕 (Toilet) | 随时间上升，需要上厕所 |

状态栏：UI 左侧显示，采用液位球设计，颜色随数值涨落。

### 5.2 行为逻辑 (FSM)

| 状态 | 行为 | 位置修正 |
|------|------|----------|
| Idle | 随机游走 | - |
| Sleep | 优先寻找床/沙发睡觉 | 根据家具朝向计算局部坐标偏移，Z轴修正防止穿模 |
| Eat | 走向饭盆吃饭 | 强制瞬移到饭盆正前方0.6米处 |
| Poop | 跳上猫砂盆 | Y轴抬升，结束后跳回地面 |
| Pet | 被玩家抚摸 | - |

**Pet 状态判定**：
- 饿了/急了/生气时拒绝抚摸
- 播放打呼噜音效 (meow_purr)，产生爱心
- 设有 patience 阈值，摸多了会生气

### 5.3 高级行为

| 行为 | 说明 |
|------|------|
| 躲避障碍 | 行走时遇到障碍物会自动绕行 |
| 声音反应 | 会转头看向声音来源（如玩具）|

### 5.4 音效反馈

| 情境 | 音效 |
|------|------|
| 随机叫 | 闲暇时概率 `meow_normal` |
| 需求叫 | 饿/急时循环 `meow_urgent` + 头顶气泡 |
| 摸爽了 | `meow_purr` |
| 生气了 | `meow_angry` |

---

## 6. 日记系统 (Diary System)

### 6.1 核心逻辑

| 项目 | 说明 |
|------|------|
| 入口 | 左下角书籍图标 |
| 生成规则 | 输入（玩家行为/离线时长）→ 滤镜（傲娇猫设）→ 输出（文本）|
| 存储结构 | 按"日期"归档，每天一张纸 |
| 翻页 | 支持查看历史日记 |

### 6.2 内容模块

| 模块 | 说明 |
|------|------|
| Meta 信息 | 每日生成天气、心情、关键词（特殊节日强制覆盖）|
| 离线日记 | 根据 LastLoginTime 补算离线期间的"脑补"日记 |
| 交互日记 | 权重系统防刷屏，同类事件 10 分钟冷却 CD |

### 6.3 家具日记分类

| 类型 | 触发条件 | 风格 |
|------|----------|------|
| 大件家具 (buy_floor) | 购买 Layer 1 地面家具 | 吐槽家具，夸奖纸箱 |
| 桌面小物 (buy_small) | 购买 Layer 2 小物件 | 调侃，想推下去 |
| 墙面挂饰 (buy_wall) | 购买墙面装饰 | 想跳起来挠下来 |

### 6.4 特定物品彩蛋

| 物品 ID | 专属日记 |
|---------|----------|
| food_bowl | 饭盆相关吐槽 |
| litter_box | 猫砂盆"冥想室" |
| ChrismasTree | 圣诞树彩蛋 |
| Television | 电视"另一个维度" |
| fireplace | 壁炉"烤肉垫" |
| ToyCarrot | 胡萝卜玩具 |
| window | 窗户"麻雀的诱惑" |
| **春节物品** | 福字、醒狮面具、中国结专属彩蛋 🆕 |

### 6.5 特殊节日

| 日期 | 节日 | 特殊内容 |
|------|------|----------|
| 12-24 | 平安夜 | 蹲守红衣胖子 |
| 12-25 | 圣诞节 | 拆礼物、抢鸡腿 |
| 1-1 | 元旦 | 跨年吐槽 |
| 2-14 | 情人节 | 单身猫凝视 |
| 春节 | 中国新年 | 躲床底、红包差评 |

### 6.6 UI 表现

| 元素 | 说明 |
|------|------|
| 风格 | B5 尺寸牛皮纸书本 |
| 左页 | 拍立得照片（当日照片）+ 日期/天气 |
| 右页 | 手写体日记列表 |
| 装饰 | 小鱼饼干贴纸、胶带、肉垫印章 |

---

## 7. 界面与交互 (UI & UX)

### 7.1 风格

**粘土/软陶风格 (Claymorphism)**：圆润、有厚度、低饱和度配色。

### 7.2 HUD 布局

| 位置 | 元素 | 说明 |
|------|------|------|
| 左上角 | 时间表盘 | 圆形粘土表盘，显示真实时间，附着天气图标可点击调出光影滑块 |
| 左侧 | 爱心栏 | 长条胶囊，左侧大爱心，右侧数字 |
| 左侧 | 状态球 | 两个圆形凹槽，液位高度代表数值 |
| 底部 | Dock | 日记入口（带红点提示）、商店入口 |
| 右上角 | Debug工具栏 | 开发用，发布时隐藏 |

### 7.3 商店面板

| 元素 | 说明 |
|------|------|
| 外观 | 横向长条软木板，带木制边框 |
| 顶部 | 5个图标页签：家具/小物/墙壁/装修/地毯 + 关闭按钮 |
| 中间 | 商品展示台 + 缩略图 + 价格吊牌（带小爱心）|
| 底部 | 自定义滚动条（绳子轨道 + 猫头滑块）|
| 交互 | 点击底部商店图标，面板从屏幕下方滑出 |

### 7.4 音效 (Audio)

| 类型 | 说明 |
|------|------|
| BGM | 舒适的背景音乐（需玩家首次交互后播放）|
| SFX | 全套 UI 点击音、弹窗音、放置家具声、倒粮声、铲屎声、金币声、玩具声 |

---

## 8. 家具数据库

### 8.1 功能型家具

| ID | 名称 | 价格 | 功能 |
|----|------|------|------|
| food_bowl | 猫食盆 | 50 | 喂食 |
| litter_box | 猫砂盆 | 80 | 如厕 |

### 8.2 地毯 (Layer 0)

| ID | 名称 | 价格 |
|----|------|------|
| rug | 圆地毯 | 20 |
| rug_squre | 方地毯 | 20 |

### 8.3 地面家具 (Layer 1)

包括：猫窝、沙发、椅子、桌子、柜子、猫爬架、盆栽、电视、壁炉、冰箱、扫地机器人等。

### 8.4 桌面小物 (Layer 2)

包括：马克杯、花瓶、唱片机、台灯、落地灯、玩具胡萝卜等。

### 8.5 墙面装饰 (wall)

包括：壁挂植物、书架、挂钟、画作、窗户、窗帘、春节装饰（福字、醒狮面具、中国结）等。

### 8.6 装修 (decor)

| 类型 | 可选项 |
|------|--------|
| 地板 | 木纹地板、白瓷砖、经典米色 |
| 墙壁 | 温馨粉墙、清爽蓝墙、蓝色木墙、薄荷墙纸、猫咪墙纸、木纹墙纸、苹果墙纸 |

---

## 附录：技术说明

### 首次加载流程

1. 游戏自动进入，无需点击开始按钮
2. 背景音乐需要玩家首次点击屏幕任意位置后才会播放（浏览器硬性限制）
3. 体验更流畅

### 存档版本

当前存档版本：`cat_game_save_v2`
